<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

use App\Models\Item;

class Carrinho extends Model
{
    use HasFactory;
    
    protected $fillable = [
      "id", 'dados', "id_usuario"
    ];

    public function setCartDataAttribute($value) {
        $this->attributes['dados'] = serialize($value);
    }

    public function getCartDataAttribute($value) {
        return unserialize($value);
    }

    // public static function savetodatabase() {
    //     if (auth()->user()) {
    //         // session -> DB
    //         $id_carrinho = Carrinho::where("id_usuario", "=", auth()->user()->id)->get()[0]->id;
    //         $items = \Cart::getContent();
    //         foreach ($items as $item) {
    //             $item_data = [
    //                 "id_carrinho" => $id_carrinho,
    //                 "nome" => $item->name,
    //                 "valor" => $item->price,
    //                 "quantidade" => $item->quantity,
    //                 "id_produto" => $item->id
    //             ];
    //             Item::create($item_data);
    //         }

    //         // DB -> session
    //         \Cart::clear();
    //         $items = Item::where("id_carrinho", "=", $id_carrinho)->get();
    //         foreach ($items as $item) {
    //             $produto = Produto::find($item->id_produto);
    //             \Cart::add([
    //                 "id" => $item->id_produto,
    //                 "name" => $item->nome,
    //                 "price" => $item->valor,
    //                 "quantity" => $item->quantidade,
    //                 "associatedModel" => $produto
    //             ]);
    //         }
    //     }
    // }
}